Автор: warm-blooded
Дата: 2021-10-04T08:28:30.000Z
Название: Сохранение озвучки книги средствами Google TTS и python
Теги: Python *, Google API *
Текст:
В последнее время я полюбил слушать аудиокниги. Однако те книги,
которые я хочу слушать никто не озвучивает. Не думаю что кому то будет
интересна моя драматичная история о выборе лучшего tts, проблемы в
процессе написания, солнце в монитор и т.п., так что я просто
представлю вам уже готовое решение. Возможно, кто то раскритикует мои
навыки, но опережу всех вас - я в курсе своих проблем, но до сих пор у
меня не возникало проблем с ориентированием в своих детищах, и пока
все работает как нужно, я полностью доволен проделанной работой, а
значит нет и необходимости что то исправлять. Тем более пока что я ни
с кем не делился своими программами, не для кого делать дружелюбный
код.Учение о получении токенаДля использования нужен токен. Его можно
получить на сайте https://gstatic.com/cloud-site-
ux/text_to_speech/text_to_speech.min.html используя демо форму. Для
этого есть два варианта.Легкий вариант.После захода на сайт ввести в
адресную строку javascript: void window.addEventListener("cloud-demo-
captcha-solved", function(ev){document.write(ev.detail.token)})После
чего нажать на кнопку SPEAK IT и решить капчу. Если же у вас во весь
экран напечаталась абракадабра - поздравляю, это и есть ваш токен,
можете его спокойно использовать, остальные варианты можно
пропустить.Если у вас после этих манипуляций ничего не произошло то
обновляйте страницу и открывайте консоль сочетанием клавиш
Ctrl+Shift+I. После чего кликнуть на поле с синей стрелкой в самом
низу и вставить туда следующий текст код:void
window.addEventListener("cloud-demo-captcha-solved",
function(ev){document.write(ev.detail.token)})После чего у вас во весь
экран опять же напечатается токен, который можно использовать. Сложный
вариант.Нужно после захода на страницу нажать сочетание клавиш
Ctrl+Shift+I. После, в открывшемся меню нажимаете или сразу на вкладку
Network, или нажимаете на две стрелочки вправо и выбираете этот пункт
там:Где найти NetworkПосле чего вы нажимаете на синюю кнопку "SPEAK
IT". Скорее всего вас попросят решить капчу. Если же вас остановит
отладчик, не отчаивайтесь. Достаточно всего лишь в открывшемся окне
консоли нажать кнопки в такой последовательности:Когда машина
заговорит, нажмите еще раз на ту же синюю кнопку, что бы она
заткнулась. Если описанное в абзаце выше произошло и вас перебросило
на другую вкладку, возвращаемся на вкладку Network и вводим в поле
фильтра, которое активно изначально, фразу "cxl-services" (естественно
без кавычек). У вас останется единственный пакет, кликаем на него и
сворачиваем в открывшемся поле все лишние заголовки кроме Query String
Parameters, что бы не мешали (но вы можете и ручками пролистать до
нужного поля). Ищем в Query String Parameters поле token, и копируем
его значение. Отступление. Я бы не стал так извращаться, если бы у
меня получилось запустить сервисный аккаунт гугла. Но, к сожалению,
для использования озвучки им необходима кредитка и много чего еще.
Нет, спасибо.Токен действует не вечно, через некоторое время его
придется заменить, но на озвучку не одной книги должно хватить. Так же
предупреждаю, если прогнать слишком много текста, google не будет
отвечать некоторое продолжительное время на запросы с вашего ip, так
что знайте меру. Куда вводить токен я расскажу далее.Для работы боту
требуется, как не странно, сама книга в текстовом формате без всяких
украшений, чистый txt. Моя читалка спокойно позволяет экспортировать
книгу в такой формат. Название самой книги задается в конфиге.Где
скачатьТак же прилагаю словарь ударений, позаимствованный с 4pda для
одной из модификаций google tts. С некоторыми моими дополнениями.
Небольшой неожиданный камень в огород хабра - почему нельзя загрузить
файлы напрямую в статью? Почему я должен извращаться с загрузкой файла
на сторонние сервисы? Ладно.Продолжим. Все четыре файла должны лежать
в одной директории со скриптом примерно так:Если у вас что то не
заработало, отправьте лог, возможно я исправлю. Использовался python
3.9.7.Все четыре файла находятся на гитхабе, скачивайте оттуда:
https://github.com/iron-blooded/book-voiceoverкак скачатьПосле
загрузки обязательно распакуйте. Так же в config.ini вам будет
необходимо указать свой токен.P.S. Если у вас в веб-форме невозможно
выбрать язык, значит с вашего ip было слишком много текста. Вам
остается только ждать, возможно даже день(я не замерял, просто вечером
появлялось ограничение, а уже следующим вечером когда руки доходили,
ограничения не было). У гугла есть какие то лимиты, но они нигде не
указываются.
