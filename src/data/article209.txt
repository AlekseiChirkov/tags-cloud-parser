Автор: Zyxel_South
Дата: 2021-10-05T09:00:01.000Z
Название: Делаем гостевую Wi-Fi сеть в ВУЗе, часть 2. Функции для гостевой Wi-Fi
сети
Теги: Блог компании ZYXEL в России, Информационная безопасность *, Сетевые
технологии *, Беспроводные технологии *, Сетевое оборудование
Текст:
Привет, Хабр!При расширении зоны действия Wi-Fi увеличением числа
точек доступа, управляемых шлюзом Zyxel VPN300 (сначала был Zyxel
UAG5100), увеличилось количество гостей и проблемы начались в час пик
со скоростью интернета, открытием сайтов, шустростью сёрфинга. Уже не
успевал мониторить/конфигурировать комплекс и оперативно реагировать
на заявки.Помощника не дали, как это своими силами лечилось и чем
настраивалось, делюсь опытом для всех и проведу краткую экскурсию по
функциям.Вот и вот мои предыдущие статьи. В конце текста информация
обо мне.  Будут рассмотрены функциина шлюзах Zyxel:Ограничение
скорости в профиле SSID;Блокировка трафика Intra-BSS;Изоляция
L2;Привязка IP/MAC адресов;BWM;Контроль сессий;Веб-
аутентификация;Биллинг;Менеджер принтеров;Ресурсы без
аутентификации;Расписание;WWW (доступ к шлюзу);Ежедневный отчёт по
E-Mail;Настройка лога с оповещением.на коммутаторах Zyxel:Neighbor
(подключённые устройства соседи);Location (световая
сигнализация).Вообще, проблемы начались ещё при UAG5100, поэтому
сначала с ним были настроены функции, опробованы в реальных условиях и
реально помогло. Поэтому, когда получили VPN300, эти же функции
активировал на нём и всё отлично работает. Уже не помню, когда гости
последний раз не могли получить фотку или отправить письмо.Функции на
шлюзах Zyxel1) Ограничение скорости в профиле SSID – ограничивает
скорость каждому гостю, подключённого к точке доступа, управляемой
шлюзом (рис.1).Блокировка трафика Intra-BSS – запрещает перекрестный
трафик в сети внутри SSID на одной точке доступа (ТД) (рис.1).На
автономные и ТД Nebula правила не действуют, только на управляемые
шлюзом ТД.Рис.1. Ограничение скорости в профиле SSID и блокировка
трафика Intra-BSS.Итог:ограничили скоростью любителей покачать
торренты или просмотром 4К на телефоне при медленном интернет-канале
провайдера.блокируется рассылка трафика от соседних телефонов в
пределах одной ТД. После этого устройства Wi-Fi уже не так много
мусора получают от соседей. Сёрфинг стал шустрее и соседи на ТД не
пингуются.2) Изоляция L2 - блокировка трафика между клиентами,
подключенными к сети шлюза (рис.2). Проводной ноутбук не сможет
пинговать Wi-Fi клиентов на любых ТД и те тоже не смогут пропинговать
ноутбук.Рис.2. Изоляция L2.Итог:ограничивается рассылка трафика от
гостевых устройств в пределах шлюза. Сёрфинг стал шустрее, ТД и соседи
на разных ТД не пингуются, кроме тех, кто внесён в белый
список;значительно повысилась отказоустойчивость сети.3) Привязка
IP/MAC-адресов – шлюз проверяет связку IP-MAC со своей базой выданных
IP при поступлении запросов (рис.3). Пользователь не сможет вручную
назначить своему компьютеру другой IP-адрес и использовать его для
подключения к шлюзу.Рис.3. Привязка IP/MAC-адресов.Итог: бывают
кулхацкеры, сканируют сеть и ставят себе чужие IP или чайники с
статическими IP на ноутбуках и долбят всю сеть в поисках домашнего
сетевого диска с IP 192.168.1.2. Шлюз препятствует их
несанкционированному вмешательству и незамедлительно сообщает на
e-mail (п.13) и в логи, успеваем принять меры по блокировке таких
гостей.4) BWM (Bandwidth Management) – управление пропускной
способностью (рис.4). Ограничение скорости силами шлюза любому
подключённому устройству/учётке/подсети или группе
устройств/учёток/подсетей.Рис.4. BWM (Bandwidth Management) –
управление пропускной способностью.В гостевой Wi-Fi сети всем
неавторизованным (их много) ограничиваем скорость до минимума
(например, 256 кбит/с), чтобы не заваливали агрессивными запросами
(куча вкладок в браузере, вирусы, обновления), но разрешаем повышенные
скорости до внешних серверов авторизации, для быстрой загрузки
страницы авторизации. Далее, всем авторизованным выставим комфортные
скорости, а VIP-персонам безлимит.ВНИМАНИЕ! VIP-персоны с безлимитными
скоростями упрутся в установленные ограничения скоростей в профиле
SSID (рис.1), поэтому в профиле SSID выставляем максимально безопасные
ограничения (30 мбит/с), чтобы VIP-персоны всю полосу на одной ТД не
заняли.Правилам можно применить расписание, к примеру, ночью
авторизованным ещё выше скорости выделять.Функционал очень широкий и
понятный. Разберётесь. Подойдёт сетям с автономными и  ТД Zyxel
Nebula.Итог: обезопасили гостевую сеть от агрессивных Wi-Fi устройств
неавторизованных гостей, которые не собираются проходить авторизацию и
засоряют её. И умеренно ограничиваем скорость большому количеству
авторизованных во избежание перегруза интернет-канала.5) Контроль
сессий – ограничение количества сессий гостям (рис.5).Рис.5. Контроль
сессий.Например, делаем так (правила действуют снизу вверх):Правило
№1. Для авторизованных телефонов и ноутбуков поставим 384, вполне
хватает для спокойного сёрфинга, чтения новостей, просмотра
роликов;Правило №2. При использовании внешнего сервиса авторизации
разрешим 1024 сессий на внешние серверы авторизации;Правило №3.
Неавторизованным поставим 256, чтобы не заваливали агрессивными
запросами (куча вкладок в браузере, вирусы, обновления).Итог: ещё раз
обезопасили гостевую сеть от агрессивных Wi-Fi устройств
неавторизованных гостей, которые не собираются проходить авторизацию,
но при этом засоряют её.6) Веб-аутентификация - авторизация гостевых
устройств перед выходом в интернет (рис.6).Рис.6. Веб-
аутентификация.Профилями выбираем интерфейсы/подсети/адреса, которые
необходимо авторизовать по постановлению Правительства РФ №758 от 31
июля 2014 года. По предварительной записи VIP-персонам, сотрудникам,
телевизорам и другим специфичным устройствам создаёте отдельный
профиль по мак-адресам и не требуете с них авторизацию или авторизуете
встроенной системой биллинга с распечаткой ваучеров на термопринтере
Zyxel SP350E. Остальные гости авторизуются внешним сервисом
авторизации по смс/звонку.Итог:гибкая возможность назначить различным
устройствам авторизацию как встроенный биллинг, внешний сервис или не
требовать авторизацию у устройств, неспособные пройти авторизацию
(телевизоры; терминалы, кассовые аппараты, активация новых Apple;
Windows);немаловажен ещё момент, а если внешний сервис не будет
доступен? Тогда всем включаем встроенный биллинг и ресепшн по
предварительной записи раздаёт ваучеры по паспорту (постановление
Правительства РФ №758 от 31 июля 2014 года). Очень удобно и полная
отказоустойчивость 24/7 при активном заселении гостей или перед
началом конференции.7) Биллинг (модуль встроенного сервиса
авторизации) - учётные записи для гостей, тарифные планы.Активируется
платной лицензией "Управление хот-спотами (биллинг)" на шлюзах Zyxel
линейки VPN (все); USG Flex (200/500/700). Функционал отсутствует у
USG Flex 100/100W и всей линейки ATP.Рис.7-1. Биллинг.Метод
аккаунтинга (Рис.7-1):Без накопления (Time-To-Finish) – при первой
авторизации по учётке, запускается таймер учёта оставшегося времени и
учётка аннулируется по истечении выданного времени с момента первой
авторизации, вне зависимости от использования интернета. Например, в 9
утра авторизовались по учётке с тарифом «2 часа», поработали полчаса и
вышли из учётки (logoff), она всё равно она аннулируется в 11 часов.
Квоты на скачивание/отправку в мбайт/гбайт недоступны в этом
методе.Накопление (Accumulation) – при первой авторизации по учётке,
запускается таймер учёта времени работы в интернете и учётка
аннулируется при израсходовании выданного времени с момента первой
авторизации. Например, в 9 утра авторизовались по учётке с тарифом «2
часа», поработали полчаса и вышли из учётки (logoff), таймер
приостановится и возобновит учёт времени при повторной авторизации и
так до повторного логоффа, или срабатывания таймаута неактивности, или
полного истечения выданного времени. Квоты на скачивание/отправку в
мбайт/гбайт доступны в этом методе.Накопительная учётная запись будет
удалена через ХХ дней – не до конца использованные учётки в любом
случае будут удаляться через ХХ дней с момента первой
авторизации.Создание профиля биллинга (тарифного плана)
(рис.7-2)."Цена", можно 0 выставить;"Период времени" устанавливается в
минутах, часах и днях (это сутки);"Тип квоты", «Всего» или
"Загрузить/скачать" устанавливается в МБайтах и ГБайтах;"Ограничить
полосу пропускания", устанавливается в кбит/с.Рис.7-2. Профили
(тарифы) биллинга.Если перед конференцией много посетителей набралось,
за один этап можно сгенерировать до 50 учёток по выбранному тарифу
(кнопка A, B или C), распечатать на обычном А4 принтере прям из
браузера и выдать. При бОльшем количестве посетителей, процедуру
генерирования учёток повторить (рис.7-3).Рис.7-3. Генератор учётных
записей для ваучеров.Wi-Fi гости, когда интернет-каналом является 3G
USB-модем.Итог:если интернет медленный (USB-модем и т.д.) и не хватает
гостям, их можно ограничить скоростями, квотами или временем в тарифах
"А". Быстрые тарифы "B" сделать платными. Тарифы "С" безлимитными;при
отсутствии или недоступности внешнего сервиса авторизации или сотовой
связи всегда можно перестраховаться включением встроенного сервиса
авторизации по ваучерам;любой гость с ваучером может зайти на
http://6.6.6.6 (настраивается в п.6, рис.6) и узнать оставшееся время,
квоты.Один из нескольких случаев, как функционал биллинга
выручил.Перед началом крупной конференции "Безопасность в ИТ" внешний
сервис авторизации упал и никто не мог авторизоваться, а гости
съехались чуть ли не со всей России и всем нужен был бесплатный Wi-Fi.
Экстренно переключили шлюз на встроенную авторизацию по ваучерам (п.6,
рис.6), распечатали 500 ваучеров и спокойно раздали всем желающим по
записи. Недовольных и позора не было. Поэтому наличие встроенного
сервиса авторизации с термопринтером очень критично.Ненадёжный внешний
сервис авторизации поменяли на надёжного, пока ни разу не подводил, но
всё равно в запасе всегда должен быть встроенный сервис авторизации,
мало ли что.8) Менеджер принтеров – управление принтерами для
распечатки ваучеров (рис.8).Активируется платной лицензией "Управление
хот-спотами (биллинг)" на шлюзах Zyxel линейки VPN (все); USG Flex
(200/500/700). Функционал отсутствует у USG Flex 100/100W и всей
линейки ATP.Поддерживает принтеры только Zyxel SP350E.  Для распечатки
ваучеров не требуется доступ к веб-управлению шлюза, достаточно нажать
на термопринтере на нужную кнопку с тарифом (создаются в п.7) и
распечатается ваучер с реквизитами. Русские символы не поддерживает.
Кодировка текста у ваучера UTF-8. Обходились транслитом.Рис.8.
Менеджер принтеров.Итог:термопринтеры мало места занимают, красивый
внешний вид, из расходников - рулонная бумага для кассовых
аппаратов;всего одна кнопка нажимается для распечатки ваучера, не
требует наличие ПК и обучение персонала.9) Ресурсы без аутентификации
– разрешение посетить сайты без авторизации (рис.9).Рис.9. Ресурсы без
аутентификации.Итог: разрешаем гостям заходить на собственные сайты
заведения (навигация, расписание, реклама, прейскурант цен), не требуя
авторизацию. Они будут отображаться на выскакивающей странице
авторизации. При попытке гостя зайти на сторонние сайты, ему снова
выскочит страница авторизации.10) Расписание – установка времени
включения/отключения какого-нибудь профиля (рис.10). Например:
радиопрофили точек доступа, SSID,  маршрутизации, направления
интернет-трафика к другому провайдеру, патруля приложений (отсутствует
у моделей VPN), правила файрволла, BWM и т.д.Рис.10. Добавление
расписания.Итог: в ночное время можно отключить радиопрофили и
интернет от «нехороших» гостей, кулхацеров, если это не гостиница. Или
перенаправить трафик к другому провайдеру, у которого ночной тариф
безлимитный и скорости больше. Или выключать ограничение скоростей в
BWM.11) WWW – доступ к шлюзу (рис.11).Рис.11. Ограничение доступа к
шлюзу.В «Контроль доступа админов» добавляем правило, выбираем зону с
Wi-Fi гостями и выставляем deny для гостевых подсетей.Итог:
перестрахуемся, запретив авторизацию админам на шлюз из гостевой Wi-Fi
подсети. Андроиды последних версий автоматически предлагают зайти на
роутер и гости подбирают пароль к шлюзу.12) Ежедневный отчёт по E-Mail
– отправка графического отчёта по E-Mail за прошедшие сутки
(рис.12-1).Рис.12-1. Выбор данных для отправки отчётаОтчёт читабельный
и информативный, 15 шт графиков и почти 80 таблиц со статистикой
внешних и внутренних интерфейсов, включая список стран, по которым
было скачивание/отправка трафика. Чтобы не утруждать скроллингом
отчёта, прикреплю пару скриншотов из отчётов (рис.12-2):
Рис.12-2.Слева отчёт ТОП-4 кол-ва клиентов и трафика. Справа отчёт
монитора сессий и график нагрузки всех WAN портов.Итог: ежесуточно на
электронную почту приходит отчёт, по ней понимаем, что гостевая сеть
работает, не зависла, гости сидят в интернете. Значительно упрощает
мониторинг и экономит время. Пока едешь на работу, знакомишься с
отчётом в почтовом клиенте телефона и делаешь вывод, что всё нормально
работает, нет острой необходимости по прибытии на рабочее место делать
обход (проверку) гостевой Wi-Fi сети, если очень занят.Отчёт о
проведении обхода.13) Настройка лога с оповещением – отправка событий
на сислог сервер, флешку и двум E-Mail (рис.13-1).Рис.13-1. Выбор
категорий лога.Выручает отправка логов (alert) сразу на E-Mail,
настроенного на телефоне, на нём входящие письма сигнализируются. Чаще
всего приходят такие категории:Аутентификация – неудачные авторизации,
блокировка Wi-Fi гостевого устройства после нескольких неудачных
попыток авторизоваться. Сразу узнаем, что с такого-то IP пытаются
подобрать пароль к логину admin или к другим.Security Policy Control –
в файрволле при установке в правиле параметра “log alert”, на почту
придут оповещения о появлении трафика, по которому правило начинает
работать. К примеру, сразу узнаем, что «нехорошие» гости прощупывают
шлюз на наличие открытых портов и других, даже если закрыты.CAPWAP –
состояние ТД (дисконнект, перезагрузка и т.д.). Сразу узнаем, что
такая-то ТД нештатно отключилась и принимаем меры.На рис.13-2
отображены оповещения о дисконнекте ТД (слева), неправильном вводе
пароля (в центре) и запросе на подключение на 22 порт шлюза
(справа).Рис.13-2. Письма-оповещения о критических событиях.Итог:после
оповещения о дисконнекте точки доступа действуем на опережение, не
тратим время на анализ заявок, как «почему телефоны у гостей не
находят SSID». Очевидно, что 99% причин – это аварийное отключение
подачи электричества PoE коммутатору;благодаря мгновенному оповещению,
всегда в курсе что происходит с гостевой сетью и понимаем, что за
проблемы у гостей. Реально помогает работе с комплексом. Доложение
обстановки.Примечание: почему на обоих скриншотах (рис.12-2 и
рис.13-2) фигурирует Zyxel UAG5100? В дни написания статьи параллельно
проводился эксперимент с Zyxel VPN300 для нового проекта. Для чистоты
эксперимента и чтобы не мешать Wi-Fi гостям, временно перекинул точки
доступа с VPN300 на резервный UAG5100, но функции роутера и
авторизации гостей оставил у VPN300. По окончании экспериментов все ТД
верну на VPN300. В принципе, в показанных скриншотах нет разницы между
UAG5100 и VPN300.Функции на коммутаторах Zyxel14) Neighbor (соседи) -
вывод списка подключённых устройств к коммутатору (рис.14-1).Нажимаем
на Status, затем Neighbor:Рис.14-1. Запускаем Neighbor.Получаем список
подключённых (Remote) PoE устройств, которые можем перезагрузить
(кнопка Cycle) или сбросить (кнопка Reset) до дефолтного состояния или
зайти по забытому IP на него (рис.14-2).Рис.14-2. Neighbor, найденные
соседи.Итог: актуально, если применил конфиг с ошибкой (к примеру,
перепутал VLAN ID) и ТД перестала отвечать или зависла. Как теперь её
сбросить или перезагрузить, если она  на высоком потолке или нет
времени выехать на объект? Поэтому Neighbor выручал сбросом или
перезагрузкой.15) Locator - световая сигнализация коммутатора. Она
мигает на лицевой панели светодиодом “Locator” синим цветом,
сигнализируя о себе (рис.15).Рис.15. Запуск Locator (светодиодной
сигнализации).Итог: если забыли коммутатор настроить, подписать и
внести в документацию или в стойке хаос. Теперь нужно его найти, где
находится, не сверяя мак-адрес и серийный номер. Такой функционал есть
у многих точек доступа Zyxel. Удобно.Текст уже большой стал.
Закругляюсь. Для учебных заведений очень полезны функции шлюза как
контентная фильтрация; патруль приложений; Гео-IP.Патруль приложений -
позволяет запретить (можно по расписанию) торренты, Ютуб и прочие не
полезные категории для учащихся или ограничивает скорость.Гео-IP -
позволяет запретить/разрешить посещать сайты по странам/группам и не
только. Можно по расписанию. Список сами создаёте. Очень пригодится
учебному заведению на фоне многочисленных разговоров об ограничении
доступа учащихся к иностранным сайтам. Он также в логах показывает из
какой страны поступил запрос к вашим IP. Ещё можно в самом шлюзе
пробить IP, какой стране принадлежит.Финальный итог и почему выбрал
Zyxel?Часть функций относится к работе с трафиком — это работа шлюза и
такое отсутствует в программных контроллерах Wi-Fi. Вот почему так
нужен встроенный Wi-Fi контроллер в железке-шлюзе. Городить комплекс
из железок (шлюз, МСЭ, контроллер) дороже, хлопотно и каждый узел
настраивать, это требует время, покупку стойки с ИБП, сплит-систему.Вы
скажете, так надёжнее! Но у шлюзов Zyxel есть функция резервирования
шлюза "Device HA Pro". Проще два одинаковых шлюза купить и поднять
резервирование между ними, всё равно они негабаритные. Вы заметили,
что ни разу не обращался к CLI (ввод текстовых команд). Всё
настраивается на веб-странице, упрощается настройка/мониторинг шлюза
для опытных пользователей или молодых ИТ-специалистов. Провайдерские
знания не потребуются. Многое можно сделать на планшете, не
заморачиваясь вводом длинных команд.Для гостевой Wi-Fi сети с
роумингом и авторизацией очень сложно найти с вышеперечисленными
функциями универсальный шлюз у других вендоров в силу отсутствия
подробных характеристик и гидов и по разумной цене. Найти у них
совместимые ТД оказалось большой проблемой, как искал их, читайте тут.
Поэтому рекомендую любые управляемые ТД Zyxel со шлюзами USG Flex /
VPN / частично ATP (ATP не поддерживает биллинг и термопринтеры).
Список управляемых ТД, поддерживаемые шлюзом, указывается в конце
документа характеристик шлюза. Например, тут. Ещё прошу обратить
внимание, как понятно и чётко перечислены функции шлюза, что внушает
доверие перед покупкой.Сохраняйте экосистему Zyxel. Бесплатная утилита
ZON найдёт Zyxel в своей подсети, списком отобразит и оттуда
сигнализацию (Locator) запустит, сбросит или прошивку обновит. С ней
значительно проще, легче и комфортнее работается. Теперь вполне
справляюсь в одиночку. Не игнорируйте коммутаторы Zyxel с PoE, есть с
индикацией нагрузки PoE на лицевой панели, упрощают работу с
инфраструктурой. Рис.17. Индикация нагрузки PoE на лицевой
панели.Хотите это обсудить? Поспорить? Пишите в комментариях, а также
общайтесь со мной и другими практикующими специалистами Zyxel в
телеграм-канале https://t.me/zyxelru.    Об авторе:Кто я? Меня зовут
Александр. 16 лет профессионально занимаюсь СКС и сетевым
оборудованием. Больше времени провожу с СКС (монтаж, обслуживание),
чем с настройкой сетевого оборудования, поэтому на настройки времени
особо нет, но получил много опыта работы с сетевым оборудованием
различных вендоров. Приветствую простоту и дружелюбность
конфигурирования/мониторинга сетевого оборудования, ответственность
вендора за качество выпускаемой продукции и готовность исправлять
недостатки, чтобы не тормозили сдачу новых проектов в назначенные
сроки. Меня можно встретить и лично пообщаться в телеграме
- @NSanchez13, так что, если будут вопросы, комментарии, мнения –
милости прошу.Другие ссылки:Часть описаний функций взята из
русскоязычной документации http://download.from.Zyxel.ru/e2a9ef2c-8a04
-4531-99ac-723ae068c44e/NXC2500_NXC5500_V4.10_UG-Rus.pdfНовостной
канал в Telegram - https://t.me/zyxel_newsТелеграм-чат поддержки для
специалистов - https://t.me/zyxelruФорум для специалистов -
https://community.zyxel.com/ru/categories  Свежие новости в FaceBook -
https://www.facebook.com/Zyxel.RussiaПолезные и интересные статьи в
блоге Zyxel на Хабре - https://habr.com/company/zyxelНаш YouTube -
https://www.youtube.com/channel/UCcNN2UCEz1e49PEaAisN5owРеализованные
проекты - https://www.zyxel.com/ru/ru/solutions/success_stories_list.s
htmlВиртуальная лаборатория
- https://support.zyxel.eu/hc/ru/sections/360001858040Удалённый стенд
- https://support.zyxel.eu/hc/ru/articles/360014708840Мастер выбора
оборудования  - select.zyxel.ruПостановление Правительства РФ №758 от
31 июля 2014 года - http://publication.pravo.gov.ru/Document/View/0001
201408050024Постановление Правительства РФ №801 от 12 августа 2014
года -
http://publication.pravo.gov.ru/Document/View/0001201408190035№ 436-ФЗ
- https://digital.gov.ru/ru/documents/3795Размеры штрафов -
https://digital.gov.ru/ru/events/33687Примеры штрафов -
https://mediapravo.com/ilaw/wi-fi-prokuratura.htmlПамятка для ЮЛ и ИП
- https://77.rkn.gov.ru/directions/p30822    Только зарегистрированные
пользователи могут участвовать в опросе. Войдите, пожалуйста. Какая
функция гостевой Wi-Fi сети заинтересовала?              0%
Ограничение скорости в профиле SSID              0
0%            Блокировка трафика Intra-BSS              0
0%            Изоляция L2              0                         0%
Привязка IP/MAC адресов              0                         0%
BWM              0                         0%            Контроль
сессий              0                         0%            Веб-
аутентификация              0                         0%
Биллинг              0                         0%            Менеджер
принтеров              0                         0%            Ресурсы
без аутентификации              0                         0%
Расписание              0                         0%            WWW
(Доступ к шлюзу)              0                         0%
Ежедневный отчёт по E-Mail              0                         0%
Настройка лога с оповещением              0                         0%
Neighbor (подключённые устройства соседи)              0
0%            Location (световая сигнализация)              0
0%            Бесплатное время (не рассматривалась в статье)
0                         0%            Контентная фильтрация (не
рассматривалась в статье)              0                         0%
Патруль приложений (не рассматривалась в статье)              0
33.33%            Гео-IP (не рассматривалась в статье)              1
66.67%            Всё перечисленное              2
Проголосовали 3 пользователя.           Воздержались 2 пользователя.
