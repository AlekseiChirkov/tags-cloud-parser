–ê–≤—Ç–æ—Ä: Waterplea
–î–∞—Ç–∞: 2021-09-27T11:45:49.000Z
–ù–∞–∑–≤–∞–Ω–∏–µ: –ù–µ–±–∏–Ω–∞—Ä–Ω—ã–π *ngIf
–¢–µ–≥–∏: –ë–ª–æ–≥ –∫–æ–º–ø–∞–Ω–∏–∏ TINKOFF, –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±-—Å–∞–π—Ç–æ–≤ *, Angular *
–¢–µ–∫—Å—Ç:
–í–∞–º –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å —Ö–æ—Ç–µ–ª–æ—Å—å –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏, –ø–æ–∫–∞ ngIf
–∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç async-–ø–∞–π–ø–∞? –ò–ª–∏, –º–æ–∂–µ—Ç, –≤—ã –º–µ—á—Ç–∞–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ ngFor
—à–∞–±–ª–æ–Ω –¥–ª—è –ø—É—Å—Ç–æ–≥–æ –º–∞—Å—Å–∏–≤–∞? –í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –±—Ä–æ—Å–∏–ª–∏ —ç—Ç–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤–∞–º
–Ω–µ —Ö–æ—Ç–µ–ª–æ—Å—å —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é –ª–æ–≥–∏–∫—É —ç—Ç–∏—Ö –¥–∏—Ä–µ–∫—Ç–∏–≤ —Å–∞–º–æ–º—É. –ù–∞
—Å–∞–º–æ–º –¥–µ–ª–µ –≤ —ç—Ç–æ–º –Ω–µ—Ç –Ω—É–∂–¥—ã! –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–µ–ª–µ–∫—Ç–æ—Ä –º–æ–∂–µ—Ç –ø–æ–¥—Ü–µ–ø–∏—Ç—å
–Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–∏–≤, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–∏–≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π.NgForOf, –±–æ–ª–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–∞—è
–∫–∞–∫ ngFor, ‚Äî –∑–Ω–∞–∫–æ–º–∞—è –≤—Å–µ–º –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞ —Å–ø–∏—Å–∫–∞. –î–æ–≤–æ–ª—å–Ω–æ
—á–∞—Å—Ç–æ —Å–ø–∏—Å–æ–∫ –±—ã–≤–∞–µ—Ç –ø—É—Å—Ç—ã–º –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–ù–∏—á–µ–≥–æ
–Ω–µ –Ω–∞–π–¥–µ–Ω–æ¬ª. –≠—Ç—É –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–∂–µ –ø—Ä–æ—Å–∏–ª–∏ –Ω–∞ github –∏ –¥–∞–∂–µ –Ω–∞–±—Ä–∞–ª–∏ 169
–ª–∞–π–∫–æ–≤. –í –∏—Ç–æ–≥–µ –µ–µ –∑–∞–≤–µ—Ä–Ω—É–ª–∏, –æ–±—ä—è—Å–Ω—è—è —Ä–µ—à–µ–Ω–∏–µ –Ω–µ–∂–µ–ª–∞–Ω–∏–µ–º —Ä–∞–∑–¥—É–≤–∞—Ç—å
core-–ø–∞–∫–µ—Ç. –ú—ã –∏ —Ç–∞–∫ –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ngIf –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª–∏–Ω—ã. –ù–æ
—Ç–æ–≥–¥–∞ —ç—Ç–æ —Ä–∞–∑–¥—É–µ—Ç –±–∞–Ω–¥–ª —Å–∞–º–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –¢–∞–∫ —á—Ç–æ –¥–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º
–¥–æ–±–∞–≤–∏—Ç—å —ç—Ç—É –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å, –¥–æ–ø–∏—Å—ã–≤–∞—è –º–∏–Ω–∏–º—É–º –∫–æ–¥–∞.* ‚Äî —ç—Ç–æ
—Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Å–∞—Ö–∞—Ä –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∏–Ω–ø—É—Ç–æ–≤–ï—Å–ª–∏ –≤—ã –ø—Ä–æ—á–ª–∏ –∏ –ø–æ–Ω—è–ª–∏
–æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –≤—ã—à–µ, —Ç–æ –≤–∞—à IQ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è —á–µ—Ç—ã—Ä–µ—Ö–∑–Ω–∞—á–Ω—ã–º —á–∏—Å–ª–æ–º.
–ù–æ –Ω–∞ –¥–µ–ª–µ –≤—Å–µ –Ω–µ —Ç–∞–∫ —Å–ª–æ–∂–Ω–æ, –∫–∞–∫ –∫–∞–∂–µ—Ç—Å—è. –ü–æ —Å—É—Ç–∏, –µ—Å–ª–∏ –±—ã —É –Ω–∞—Å –±—ã–ª
–∏–Ω–ø—É—Ç ngForEmpty, –º—ã –º–æ–≥–ª–∏ –±—ã –Ω–∞–ø–∏—Å–∞—Ç—å: *ngFor="let item of items
empty template" –∏ –ø–µ—Ä–µ–¥–∞—Ç—å template reference-–ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –ø—É—Å—Ç–æ–≥–æ
—Å–æ—Å—Ç–æ—è–Ω–∏—è. –¢–∞–∫ —á—Ç–æ –¥–∞–≤–∞–π—Ç–µ –¥–æ–±–∞–≤–∏–º —Å–≤–æ—é –¥–∏—Ä–µ–∫—Ç–∏–≤—É —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º ngFor,
—É –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç —Ç–∞–∫–æ–π –∏–Ω–ø—É—Ç:@Directive({    selector:
'[ngFor][ngForOf][ngForEmpty]', }) export class TuiForDirective
implements OnChanges {    @Input()    ngForOf = [];     @Input()
ngForEmpty: TemplateRef<{}>;     private ref?: EmbeddedViewRef<{}>;
constructor(private readonly vcr: ViewContainerRef) {}
ngOnChanges() {        this.ref?.destroy();         if
(this.ngForOf?.length === 0) {            this.ref =
this.vcr.createEmbeddedView(this.ngForEmpty);        }    } } –í–æ—Ç –∏
–≤—Å–µ! –ö–æ–≥–¥–∞ ngFor –º–µ–Ω—è–µ—Ç—Å—è, –º—ã —É–Ω–∏—á—Ç–æ–∂–∞–µ–º –Ω–∞—à —à–∞–±–ª–æ–Ω –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞, –∏
–µ—Å–ª–∏ –º–∞—Å—Å–∏–≤ –ø—É—Å—Ç–æ–π, —Å–æ–∑–¥–∞–µ–º –µ–≥–æ. –¢–∞–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –Ω–∞—à –±–∞–Ω–¥–ª
–ø–æ—Ç—è–Ω–µ—Ç!–ù–µ–±–∏–Ω–∞—Ä–Ω—ã–π ngIfNgIf –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –∏—Å—Ö–æ–¥—è
–∏–∑ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö. –ù–æ –∏–Ω–æ–≥–¥–∞ —ç—Ç–æ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –î–æ–ø—É—Å—Ç–∏–º, –º—ã
—Ö–æ—Ç–∏–º —Ä–∞–∑–ª–∏—á–∞—Ç—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö, –∑–∞–≥—Ä—É–∑–∫—É –∏ –æ—à–∏–±–∫—É.
–ß—Ç–æ –µ—Å–ª–∏ —è —Å–∫–∞–∂—É –≤–∞–º, —á—Ç–æ —ç—Ç–æ–º—É –±–µ–∑—É–º–Ω–æ–º—É —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–µ
—Ö–≤–∞—Ç–∞–µ—Ç –≤—Å–µ–≥–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–æ–∫?<p *ngIf="value$ | async as value else
default or loading but error">   {{value}} </p>–î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—à–∏—Ä–∏–º ngIf —Å
–ø–æ–º–æ—â—å—é or –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ but –¥–ª—è –æ—à–∏–±–∫–∏. –ù–∏–∂–µ —è –ø—Ä–∏–≤–µ–ª –∑–∞–≥–æ—Ç–æ–≤–∫—É
—Ç–∞–∫–æ–π –¥–∏—Ä–µ–∫—Ç–∏–≤—ã —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏:@Directive({   selector:
'[ngIf][ngIfOr],[ngIf][ngIfBut]' }) export class
NgIfAugmentedDirective<T> implements OnChanges {   // –°–ª–µ–¥–∏–º –∑–∞
–∑–Ω–∞—á–µ–Ω–∏–µ–º   @Input()   ngIf: unknown = false;    // –°–ª–µ–¥–∏–º –∑–∞
–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º —à–∞–±–ª–æ–Ω–æ–º   @Input()   ngIfThen:
TemplateRef<NgIfContext<T>> = this.templateRef;    // –°–ª–µ–¥–∏–º –∑–∞
—à–∞–±–ª–æ–Ω–æ–º ‚Äúelse‚Äù   @Input()   ngIfElse: TemplateRef<NgIfContext<T>> |
null = null;    // –®–∞–±–ª–æ–Ω —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏   @Input()   ngIfOr:
TemplateRef<NgIfContext<T>> | null = null;    // –®–∞–±–ª–æ–Ω —Å–æ—Å—Ç–æ—è–Ω–∏—è
–æ—à–∏–±–∫–∏   @Input()   ngIfBut: TemplateRef<NgIfContext<T>> | null =
null;    constructor(     // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ *ngIf      private
readonly directive: NgIf<T>,     private readonly templateRef:
TemplateRef<NgIfContext<T>>   ) {} }–ú—ã –∏–Ω–∂–µ–∫—Ç–∏–º ngIf, —á—Ç–æ–±—ã –æ–Ω –¥–µ–ª–∞–ª
–≤—Å—é —Ä–∞–±–æ—Ç—É –∑–∞ –Ω–∞—Å. –ò—Å–ø–æ–ª—å–∑—É–µ–º null –∫–∞–∫ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ
–µ–≥–æ –≤—ã–¥–∞–µ—Ç async-–ø–∞–π–ø, –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –µ—â–µ –Ω–µ –ø—Ä–∏–ª–µ—Ç–µ–ª–∏. –î–ª—è –æ—à–∏–±–∫–∏ –±—É–¥–µ–º
–ø—Ä–æ–≤–µ—Ä—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ instanceof Error.–í—Å–µ, —á—Ç–æ –Ω—É–∂–Ω–æ, –±—É–¥–µ—Ç
–ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –≤–Ω—É—Ç—Ä–∏ ngOnChanges. –ú—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–¥–∞–µ–º
–Ω—É–∂–Ω—ã–π —à–∞–±–ª–æ–Ω –≤ ngIf. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –µ–≥–æ –Ω–∞ –∏—Å—Ö–æ–¥–Ω–æ–µ
–∑–Ω–∞—á–µ–Ω–∏–µ:ngOnChanges() {   // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –ø–æ—ç—Ç–æ–º—É –º—ã   //
–ø–µ—Ä–µ–¥–∞–µ–º —à–∞–±–ª–æ–Ω –≤ ngIfElse –∏ –≤—ã—Ö–æ–¥–∏–º   if (this.ngIf === null &&
this.ngIfOr) {     this.directive.ngIfElse = this.ngIfOr;      return;
}    // –î–∞–Ω–Ω—ã–µ —Ç–∏–ø–∞ Error –æ–∑–Ω–∞—á–∞—é—Ç, —á—Ç–æ –º—ã –ø–µ—Ä–µ–¥–∞–µ–º   // —à–∞–±–ª–æ–Ω –≤
ngIfThen –∏ –¥–µ–ª–∞–µ–º —Ä–∞–Ω–Ω–∏–π –≤—ã—Ö–æ–¥   if (this.ngIf instanceof Error &&
this.ngIfBut) {     this.directive.ngIfThen = this.ngIfBut;
return;   }    // –ï—Å–ª–∏ –Ω–∏ —Ç–æ –Ω–∏ —Ç–æ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–æ—Å—å,   // —Å–±—Ä–∞—Å—ã–≤–∞–µ–º
—à–∞–±–ª–æ–Ω—ã   if (this.directive.ngIfThen !== this.ngIfThen) {
this.directive.ngIfThen = this.ngIfThen;   }    if
(this.directive.ngIfElse !== this.ngIfElse) {
this.directive.ngIfElse = this.ngIfElse;   } } –ß–µ—Ç—ã—Ä–µ —É—Å–ª–æ–≤–∏—è –∏ —á–µ—Ç—ã—Ä–µ
—Å—Ç—Ä–æ—á–∫–∏ –∫–æ–¥–∞ ‚Äî —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å–µ–ª–µ–∫—Ç–æ—Ä.
–î–∏—Ä–µ–∫—Ç–∏–≤–∞ —Å–æ–∑–¥–∞—Å—Ç—Å—è, –µ—Å–ª–∏ –º—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–º —Ç–æ—Ç –∏–ª–∏ –∏–Ω–æ–π —à–∞–±–ª–æ–Ω —á–µ—Ä–µ–∑
—Å–∞—Ö–∞—Ä –∏–ª–∏ —è–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.–†–µ–∑—É–ª—å—Ç–∞—ÇNgFor —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å
async-–ø–∞–π–ø–æ–º. –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫ –Ω–∞—à–µ–π –¥–∏—Ä–µ–∫—Ç–∏–≤–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç
–≤—Å–µ–≥–æ –ø–∞—Ä—É —Å—Ç—Ä–æ–∫. –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –Ω–∞ —ç—Ç–æ–º
StackBlitz.–î–∏—Ä–µ–∫—Ç–∏–≤—ã Angular –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Ä–∞–∑–±–∏—Ç—å
–ª–æ–≥–∏–∫—É –Ω–∞ —á–∞—Å—Ç–∏. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤–µ—Å–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–∏–≤ –Ω–∞ –æ–¥–∏–Ω
—Å–µ–ª–µ–∫—Ç–æ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ç–æ –¥–µ–ª–∞—Ç—å –µ—â–µ –±–æ–ª–µ–µ –≥–∏–±–∫–æ. –î–∞–∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ
–¥–∏—Ä–µ–∫—Ç–∏–≤—ã –∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Å–∞—Ö–∞—Ä —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–∞–∫ –∂–µ. –ò–º–µ–π—Ç–µ —ç—Ç–æ –≤ –≤–∏–¥—É,
–∫–æ–≥–¥–∞ –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Å–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∏—Ç—å –∫–∞–∫–æ–µ-—Ç–æ —Å–ª–æ–∂–Ω–æ–µ
—Ä–µ—à–µ–Ω–∏–µ üòâ
